name: kk-app CI

on:
  push:
    branches:
      - action-test

jobs:
  build:
    runs-on: windows-latest
    permissions:
      contents: read
    steps:

      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v2
        with:
          msbuild-architecture: x64

      - name: Compile Visual Studio project with MSBuild
        shell: cmd
        run: ${{ '"C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\Tools\VsDevCmd.bat"' }}

      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          submodules: 'true'

      - name: Install Vulkan SDK
        uses: jakoch/install-vulkan-sdk-action@v1.0.0
        with:
          vulkan_version: 1.3.231.1
          install_runtime: true
          cache: true
          stripdown: true

#      - name: Set up vcpkg
#        run: |
#          git clone https://github.com/microsoft/vcpkg.git
#          cd vcpkg
#          ./bootstrap-vcpkg.sh
      - name: Install Ninja
        uses: turtlesec-no/get-ninja@main
      - name: Configure CMake
        run: |
          mkdir build
          ${{ '"C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\Tools\VsDevCmd.bat"' }}
          cmake -DCMAKE_BUILD_TYPE=RELEASE -G Ninja -DCMAKE_C_COMPILER=cl -DCMAKE_CXX_COMPILER=cl -S . -B build
      - name: Build with Ninja
        run: |
          cd build
          ${{ '"C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\Tools\VsDevCmd.bat"' }}
          ninja
#      - name: Create Release
#        id: create_release
#        uses: softprops/action-gh-release@v1
#